{% extends "base.html" %}
{% load static %}
{% block content %}
<h2>Регистрация</h2>

<form id="regForm" method="post" enctype="multipart/form-data" class="form">
  {% csrf_token %}

  <div class="center">
    <div id="dropzone" class="dropzone" style="max-width:420px;width:100%;">
      <input id="avatarInput" type="file" name="avatar" accept="image/*" hidden>
      <div id="dzText">Перетащите аватар сюда или кликните для выбора</div>
      <img id="preview" class="avatar preview" style="display:none;" />
    </div>
  </div>

  <div class="field"><label>Никнейм (в игре)</label><input name="login" required placeholder="Например, Admiral_77"></div>
  <div class="field"><label>Username</label><input name="username" required></div>
  <div class="field"><label>Email</label><input type="email" name="email" placeholder="необязательно"></div>
  <div class="field"><label>Пароль</label><input type="password" name="password" required></div>
  <div class="field"><label>Повтор пароля</label><input type="password" name="password2" required></div>

  <button type="submit" class="btn">Зарегистрироваться</button>
</form>

<script>
(function(){
  const dz = document.getElementById('dropzone');
  const input = document.getElementById('avatarInput');
  const preview = document.getElementById('preview');
  const dzText = document.getElementById('dzText');
  function setFile(file){
    const dt=new DataTransfer(); dt.items.add(file); input.files=dt.files;
    const fr=new FileReader();
    fr.onload=e=>{ preview.src=e.target.result; preview.style.display='block'; dzText.style.display='none'; };
    fr.readAsDataURL(file);
  }
  dz.addEventListener('click', ()=> input.click());
  dz.addEventListener('dragover', e=>{ e.preventDefault(); dz.classList.add('drag'); });
  dz.addEventListener('dragleave', ()=> dz.classList.remove('drag'));
  dz.addEventListener('drop', e=>{ e.preventDefault(); dz.classList.remove('drag'); const f=e.dataTransfer.files?.[0]; if(f) setFile(f); });
  input.addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) setFile(f); });
})();
</script>
{% endblock %}